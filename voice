#!/usr/bin/env bash
# Voice typing launcher — auto-detects terminal vs GUI, uses evdev key injection

SCRIPT_DIR="$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" && pwd)"

# Default: large-v3 with CUDA for best accuracy
DEFAULT_ARGS=""
if [ $# -eq 0 ]; then
    DEFAULT_ARGS="--model large-v3 --device cuda"
    echo "Using large-v3 on CUDA (best accuracy)"
    echo "Options: tiny, base, small, medium, large-v3, distil-large-v3, large-v3-turbo"
    echo "Add --streaming for real-time onnx mode (partial words as you speak)"
fi

# Check session type
if [ "$XDG_SESSION_TYPE" = "wayland" ]; then
    echo "Wayland detected — using evdev/uinput key injection"
    echo "Bind F12 to ./voice-toggle for pause/resume"
elif [ "$XDG_SESSION_TYPE" = "x11" ]; then
    echo "X11 detected — using xdotool"
fi

exec nix-shell "$SCRIPT_DIR/shell.nix" --run "python -u \"$SCRIPT_DIR/enhanced-voice-typing.py\" $DEFAULT_ARGS $*"
